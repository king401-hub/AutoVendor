{% extends 'base.html' %}
{% load static %}

{% block title %}User Profile | AutoVendor{% endblock %}

{% block content %}
<div class="container-fluid min-vh-100 p-0" style="font-family: 'Lato', 'Montserrat', Arial, sans-serif; background: linear-gradient(180deg, #0f1724 0%, #0b1220 100%); color: #e2e4e4;">
  <div class="row g-0">
    <!-- Sidebar -->
  <div class="col-lg-2 col-md-3 border-end px-3 py-4 d-flex flex-column" style="min-height:100vh; background: #111827; color: #e2e4e4;">
      <nav class="nav flex-column">
        <a class="nav-link active mb-2 text-secondary" href="#"><i class="bi bi-person-circle me-2"></i> My Profile</a>
        <a class="nav-link mb-2 text-secondary" href="{% url 'dashboard' %}"><i class="bi bi-clipboard-data me-2"></i> Dashboard</a>
        <a class="nav-link mb-2 text-secondary" href="{% url 'my_cars' %}"><i class="bi bi-car-front-fill me-2"></i> My Cars</a>
        <a class="nav-link mb-2 text-secondary" href="{% url 'chats' %}"><i class="bi bi-chat-dots me-2"></i> Chats</a>
        <a class="nav-link mb-2 text-secondary" href="{% url 'receipts' %}"><i class="bi bi-receipt me-2"></i> Receipts</a>
        <a class="nav-link mb-2 text-secondary" href="{% url 'settings' %}"><i class="bi bi-gear me-2"></i> Settings</a>
  <a class="nav-link sidebar-link mt-4 text-secondary" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right me-2"></i> Logout</a>
      </nav>
      <div class="mt-auto pt-4">
        <small class="text-muted">Help & Support</small>
      </div>
    </div>
    <!-- Main Content -->
    <div class="col-lg-10 col-md-9 px-5 py-4">
      <!-- Profile Stats -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card border-0 shadow-sm text-center" style="background: #1a2233; color: #ffd700;">
            <div class="card-body">
              <h6 class="fw-bold text-secondary">Total Cars</h6>
              <div class="display-6 fw-bold">{{ user.cars.count }}</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-0 shadow-sm text-center" style="background: #1a2233; color: #0ea5a6;">
            <div class="card-body">
              <h6 class="fw-bold text-secondary">Chats</h6>
              <div class="display-6 fw-bold">{{ user.chats.count }}</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-0 shadow-sm text-center" style="background: #1a2233; color: #06b6d4;">
            <div class="card-body">
              <h6 class="fw-bold text-secondary">Receipts</h6>
              <div class="display-6 fw-bold">{{ user.receipts.count }}</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-0 shadow-sm text-center" style="background: #1a2233; color: #fff;">
            <div class="card-body">
              <h6 class="fw-bold text-secondary">Notifications</h6>
              <div class="display-6 fw-bold">{{ user.notifications.count }}</div>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="fw-bold text-secondary">Good Evening! {{ user.first_name }}</h2>
          <div class="d-flex gap-4 mt-2">
            <span><i class="bi bi-clock me-1"></i> 12hrs Time Saved</span>
            <span><i class="bi bi-check2-circle me-1"></i> 24 Projects Completed</span>
            <span><i class="bi bi-hourglass-split me-1"></i> 7 Projects In-progress</span>
          </div>
        </div>
        <div>
          <button class="btn btn-primary rounded-pill px-4"><i class="bi bi-plus-lg me-2"></i>New Project</button>
          <img src="{{ user.profile_image.url }}" class="rounded-circle ms-3" style="width:48px; height:48px; object-fit:cover; border:2px solid #eee;">
        </div>
      </div>
  <div class="row g-4">
        <!-- Projects/Tasks -->
        <div class="col-lg-7">
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body">
              <h5 class="fw-bold mb-3">My Projects <span class="badge bg-light text-dark ms-2">This Week</span></h5>
              <table class="table table-borderless align-middle mb-0">
                <thead>
                  <tr class="text-muted">
                    <th>Task Name</th>
                    <th>Assign</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Help DSStudio get more customers</td>
                    <td><span class="badge bg-light text-dark">Phoenix Winters</span></td>
                    <td><span class="badge bg-success">In Progress</span></td>
                  </tr>
                  <tr>
                    <td>Plan a trip</td>
                    <td><span class="badge bg-light text-dark">Cohon Merritt</span></td>
                    <td><span class="badge bg-warning text-dark">Pending</span></td>
                  </tr>
                  <tr>
                    <td>Return a package</td>
                    <td><span class="badge bg-light text-dark">Lukas Juarez</span></td>
                    <td><span class="badge bg-primary">Completed</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!-- Schedule -->
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body">
              <h5 class="fw-bold mb-3">Schedule</h5>
              <div class="d-flex gap-3 mb-2">
                <span class="fw-semibold">Mo 15</span>
                <span class="fw-semibold">Tu 16</span>
                <span class="fw-semibold text-primary">We 17</span>
                <span class="fw-semibold">Th 18</span>
                <span class="fw-semibold">Fr 19</span>
                <span class="fw-semibold">Sa 20</span>
                <span class="fw-semibold">Su 14</span>
              </div>
              <ul class="list-unstyled mb-0">
                <li class="mb-3">
                  <span class="badge bg-success me-2">Kickoff Meeting</span>
                  <span class="text-muted">01:00 PM to 03:30 PM</span>
                </li>
                <li class="mb-3">
                  <span class="badge bg-primary me-2">Create Wordpress website for event Registration</span>
                  <span class="text-muted">04:00 PM to 02:30 PM</span>
                </li>
                <li>
                  <span class="badge bg-warning text-dark me-2">Create User flow for hotel booking</span>
                  <span class="text-muted">05:00 PM to 02:30 PM</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <!-- Notes & Activity Feed -->
        <div class="col-lg-5">
          <div class="card border-0 shadow-sm mb-4" style="background: #232b3e; color: #e2e4e4;">
            <div class="card-body">
              <h5 class="fw-bold mb-3">Notes</h5>
              <ul class="list-group list-group-flush mb-4">
                <li class="list-group-item bg-transparent text-light">
                  <strong>Landing Page For Website</strong><br>
                  <span class="text-muted">To get started on a landing page, could you provide a bit more detail about its purpose?</span>
                </li>
                <li class="list-group-item bg-transparent text-light">
                  <strong>Fixing icons with dark backgrounds</strong><br>
                  <span class="text-muted">Use icons that are easily recognizable and straightforward. Avoid overly complex designs that might confuse users.</span>
                </li>
                <li class="list-group-item bg-transparent text-light">
                  <strong>Discussion regarding userflow improvement</strong><br>
                  <span class="text-muted">What's the main goal of the landing page? (e.g., lead generation, product)</span>
                </li>
              </ul>
              <h5 class="fw-bold mb-3">Activity Feed</h5>
              <ul class="list-group list-group-flush">
                {% for activity in user.activities.all|slice:':5' %}
                <li class="list-group-item bg-transparent text-light">
                  <i class="bi bi-bell-fill text-warning me-2"></i>{{ activity.message }}<br>
                  <small class="text-muted">{{ activity.timestamp|date:'M d, H:i' }}</small>
                </li>
                {% empty %}
                <li class="list-group-item bg-transparent text-light">No recent activity.</li>
                {% endfor %}
              </ul>
            </div>
          </div>
          <!-- Quick Actions -->
          <div class="card border-0 shadow-sm mb-4" style="background: #232b3e; color: #e2e4e4;">
            <div class="card-body">
              <h5 class="fw-bold mb-3">Quick Actions</h5>
              <div class="d-flex flex-wrap gap-3">
                <a href="#" class="btn btn-primary rounded-pill">Add Car</a>
                <a href="#" class="btn btn-secondary rounded-pill">Start Chat</a>
                <a href="#" class="btn btn-warning rounded-pill">Upload Receipt</a>
                <a href="#" class="btn btn-info rounded-pill">View Notifications</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
  <div class="row">
      <!-- Navbar -->
  <div class="container-fluid nav-bar sticky-top px-0 px-lg-4 py-2 py-lg-0">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-dark">
        <a href="/" class="navbar-brand p-0 d-flex align-items-center gap-1">
          <img src="{% static 'img/logo.png' %}" alt="Logo" style="width:47px; height:59px; border-radius:50%; object-fit:cover; margin-right:-12px;">
          <h1 class="fs-5 mb-0">utoVendor</h1>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
          <span class="fa fa-bars"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <div class="navbar-nav mx-auto py-0">
            <a href="{% url 'index' %}" class="nav-item nav-link active">Home</a>
            <a href="{% url 'about' %}" class="nav-item nav-link">About</a>
            <a href="{% url 'service' %}" class="nav-item nav-link">Service</a>
            <a href="{% url 'blog' %}" class="nav-item nav-link">Blog</a>

            <div class="nav-item dropdown">
              <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Pages</a>
              <div class="dropdown-menu m-0">
                <a href="{% url 'feature' %}" class="dropdown-item">Our Feature</a>
                <a href="{% url 'cars' %}" class="dropdown-item">Our Cars</a>
                <a href="{% url 'team' %}" class="dropdown-item">Our Team</a>
                <a href="{% url 'testimonial' %}" class="dropdown-item">Testimonial</a>
                <a href="{% url 'inspect' %}" class="dropdown-item">Inspection</a>
              </div>
            </div>
            <a href="{% url 'contact' %}" class="nav-item nav-link">Contact</a>
          </div>
          {% if request.user.is_authenticated %}
          
          <span class="fw-bold ms-3" 
                style="font-size:clamp(1rem, 2vw, 1.3rem); color:#e2e4e4; letter-spacing:2px;">
            Hi, {{ request.user.first_name }} {{ request.user.last_name }}.
</span> 
<button type="button" class="btn d-flex align-items-center" 
        data-bs-toggle="modal" data-bs-target="#profileModal" 
        style="border: none; background: none; padding: 0;">
  
  <img src="{{ request.user.profile_image.url }}"
       alt="User Image"
       style="height:58px; width:55px; border-radius:50%; border:3px solid #ecf0f0; object-fit:cover; margin-right: 6px;">
  <!-- Icon (with spacing) -->
  <i class="bi bi-caret-down-fill" style="font-size:18px; color:#555; margin-left:6px;"></i>
</button>
          {% else %}
<a href="{% url 'login' %}" class="btn mx-lg-3 btn-outline-light rounded-pill py-2 px-4">Login</a>
          <a href="{% url 'register' %}" class="btn btn-primary rounded-pill py-2 px-4">Get Started</a>
          {% endif %}
        </div>
      </nav>
    </div>
  </div>
    
    <!-- Sidebar (Profile Card) -->
    <div class="col-md-4 col-lg-3 mb-4">
      <div class="card shadow-lg border-0 rounded-3">
        <div class="card-body text-center">
          <img src="{{ user.profile_image.url }}" 
               class="rounded-circle border shadow-sm mb-3"
               style="width:120px; height:120px; object-fit:cover;">
          <h5 class="card-title fw-bold">{{ user.get_full_name }}</h5>
          <p class="text-muted mb-1">{{ user.job_title }}</p>
          <p class="text-muted small">{{ user.email }}</p>

          <!-- Edit Profile Button -->
          <button class="btn btn-primary btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#editProfileModal">
            <i class="bi bi-pencil-square me-1"></i> Edit Profile
          </button>
        </div>
      </div>
    </div>

    <!-- Main Profile Details -->
    <div class="col-md-8 col-lg-9">
      <div class="card shadow-lg border-0 rounded-3">
        <div class="card-body">
          <h4 class="fw-bold mb-3"><i class="bi bi-person-lines-fill me-2"></i> Profile Information</h4>
          <hr>
          <div class="row mb-3">
            <div class="col-md-6">
              <p class="mb-1 fw-semibold">Full Name</p>
              <p class="text-muted">{{ user.get_full_name }}</p>
            </div>
            <div class="col-md-6">
              <p class="mb-1 fw-semibold">Email</p>
              <p class="text-muted">{{ user.email }}</p>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <p class="mb-1 fw-semibold">Phone</p>
              <p class="text-muted">{{ user.phone }}</p>
            </div>
            <div class="col-md-6">
              <p class="mb-1 fw-semibold">Address</p>
              <p class="text-muted">{{ user.address }}</p>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <p class="mb-1 fw-semibold">Job Title</p>
              <p class="text-muted">{{ user.job_title }}</p>
            </div>
          </div>
          <div>
            <p class="mb-1 fw-semibold">About Me</p>
            <p class="text-muted">{{ user.bio }}</p>
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-3 shadow-lg">
      <div class="modal-header bg-secondary text-white">
        <h5 class="modal-title" id="editProfileModalLabel"><i class="bi bi-person-lines-fill me-2"></i>Edit Profile</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <form method="POST" action="{% url 'user_profile_update' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal-body">
          <div class="row g-3">
            
            <!-- Profile Image -->
            <div class="col-md-12 text-center mb-3">
              <img src="{{ user.profile_image.url }}" id="editProfilePic"
                   class="rounded-circle border shadow-sm mb-2"
                   style="width:100px; height:100px; object-fit:cover;">
              <input type="file" name="profile_image" class="form-control mt-2" onchange="previewEditImage(event)">
            </div>
            
            <!-- Full Name -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">First Name</label>
              <input type="text" name="first_name" class="form-control" value="{{ user.first_name }}">
            </div>
            
              <div class="col-md-6">
              <label class="form-label fw-semibold">Last Name</label>
              <input type="text" name="last_name" class="form-control" value="{{ user.last_name }}">
            </div>
            <!-- Email -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Email</label>
              <input type="email" name="email" class="form-control" value="{{ user.email }}">
            </div>
            
            <!-- Phone -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Phone</label>
              <input type="text" name="phone" class="form-control" value="{{ user.phone }}">
            </div>
            
            <!-- Address -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Address</label>
              <input type="text" name="address" class="form-control" value="{{ user.address }}">
            </div>
            
            <!-- Job Title -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Job Title</label>
              <input type="text" name="job_title" class="form-control" value="{{ user.job_title }}">
            </div>
            
            <!-- Bio -->
            <div class="col-md-12">
              <label class="form-label fw-semibold">About Me</label>
              <textarea name="bio" class="form-control" rows="4">{{ user.bio }}</textarea>
            </div>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary px-4">
            <i class="bi bi-check-circle me-1"></i> Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
  <!-- Footer (kept) -->
  <div class="container-fluid footer bg-dark text-light py-5 wow fadeIn" data-wow-delay="0.2s">
    <div class="container py-5">
      <div class="row g-5">
        <div class="col-md-6 col-lg-6 col-xl-3">
          <div class="footer-item d-flex flex-column">
            <h4 class="text-white mb-4">About Us</h4>
            <p class="mb-3">We are dedicated to offering top-quality vehicles and exceptional customer service. Trust us for reliable and affordable car solutions every time.</p>
            <div class="position-relative">
              <input class="form-control rounded-pill w-100 py-3 ps-4 pe-5" type="email" placeholder="Enter your email" aria-label="Email address">
              <button type="button" class="btn btn-secondary rounded-pill position-absolute top-0 end-0 py-2 mt-2 me-2">Subscribe</button>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-lg-6 col-xl-3">
          <div class="footer-item d-flex flex-column">
            <h4 class="text-white mb-4">Quick Links</h4>
            <a href="#"><i class="fas fa-angle-right me-2"></i> About Us</a>
            <a href="#"><i class="fas fa-angle-right me-2"></i> Our Cars</a>
            <a href="#"><i class="fas fa-angle-right me-2"></i> Car Categories</a>
            <a href="#"><i class="fas fa-angle-right me-2"></i> Meet the Team</a>
            <a href="#"><i class="fas fa-angle-right me-2"></i> Contact</a>
            <a href="#"><i class="fas fa-angle-right me-2"></i> Terms & Conditions</a>
          </div>
        </div>
        <div class="col-md-6 col-lg-6 col-xl-3">
          <div class="footer-item d-flex flex-column">
            <h4 class="text-white mb-4">Business Hours</h4>
            <div class="mb-3">
              <h6 class="text-muted mb-0">Mon - Fri:</h6>
              <p class="text-white mb-0">09:00 AM - 07:00 PM</p>
            </div>
            <div class="mb-3">
              <h6 class="text-muted mb-0">Saturday:</h6>
              <p class="text-white mb-0">10:00 AM - 05:00 PM</p>
            </div>
            <div class="mb-3">
              <h6 class="text-muted mb-0">Sunday:</h6>
              <p class="text-white mb-0">Closed (Vacation)</p>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-lg-6 col-xl-3">
          <div class="footer-item d-flex flex-column">
            <h4 class="text-white mb-4">Contact Info</h4>
            <a href="#"><i class="fa fa-map-marker-alt me-2"></i> 123 Main Street, New York, NY</a>
            <a href="mailto:info@example.com"><i class="fas fa-envelope me-2"></i> info@example.com</a>
            <a href="tel:+01234567890"><i class="fas fa-phone me-2"></i> +012 345 67890</a>
            <a href="tel:+01234567890"><i class="fas fa-print me-2"></i> +012 345 67890</a>
            <div class="d-flex mt-3">
              <a class="btn btn-secondary btn-md-square rounded-circle me-2" href="#" aria-label="Facebook"><i class="fab fa-facebook-f text-white"></i></a>
              <a class="btn btn-secondary btn-md-square rounded-circle me-2" href="#" aria-label="Twitter"><i class="fab fa-twitter text-white"></i></a>
              <a class="btn btn-secondary btn-md-square rounded-circle me-2" href="#" aria-label="Instagram"><i class="fab fa-instagram text-white"></i></a>
              <a class="btn btn-secondary btn-md-square rounded-circle" href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in text-white"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid copyright py-4 bg-dark text-white">
    <div class="container">
      <div class="row g-4 align-items-center">
        <div class="col-md-6 text-center text-md-start">
          <span class="text-light">
            &copy; <a href="{% url 'index' %}" class="text-decoration-underline text-white fw-semibold">AutoVendor</a>. All rights reserved.
          </span>
        </div>
        <div class="col-md-6 text-center text-md-end">
          <small>
            Designed by 
            <a href="mailto:solomonenoch663@gmail.com" class="text-decoration-underline text-white fw-semibold">King Xolo</a> 
            | Distributed by 
            <a href="mailto:solomonenoch663@gmail.com" class="text-decoration-underline text-white fw-semibold">King Xolo</a>
          </small>
        </div>
      </div>
    </div>
  </div>


  <!-- Back to Top -->
  <a href="#" class="btn btn-secondary btn-lg-square rounded-circle back-to-top"><i class="fa fa-arrow-up"></i></a>
<!-- Script for Image Preview -->
<script>
  function previewEditImage(event) {
    const reader = new FileReader();
    reader.onload = function() {
      document.getElementById('editProfilePic').src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- JavaScript Libraries -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'lib/wow/wow.min.js' %}"></script>
  <script src="{% static 'lib/easing/easing.min.js' %}"></script>
  <script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
  <script src="{% static 'lib/counterup/counterup.min.js' %}"></script>
  <script src="{% static 'lib/owlcarousel/owl.carousel.min.js' %}"></script>

  <!-- Template Javascript -->
  <script src="{% static 'js/main.js' %}"></script>
</body>
</html>
 